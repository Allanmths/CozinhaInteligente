rules_version = '2';

// üîÑ REGRAS DE TRANSI√á√ÉO - COZINHA INTELIGENTE
// Vers√£o de Migra√ß√£o: Permissiva para permitir migra√ß√£o de dados
// IMPORTANTE: Use estas regras temporariamente durante a migra√ß√£o

service cloud.firestore {
  match /databases/{database}/documents {
    
    // ===============================
    // üõ°Ô∏è FUN√á√ïES DE SEGURAN√áA B√ÅSICAS
    // ===============================
    
    function isAuthenticated() {
      return request.auth != null && request.auth.uid != null;
    }
    
    function isOwner(userId) {
      return isAuthenticated() && request.auth.uid == userId;
    }
    
    // Fun√ß√£o mais permissiva para transi√ß√£o
    function canAccess() {
      return isAuthenticated();
    }
    
    // Verificar se documento tem restaurantId
    function hasRestaurantId() {
      return request.resource.data.keys().hasAny(['restaurantId']) ||
             resource.data.keys().hasAny(['restaurantId']);
    }
    
    // ===============================
    // üè¢ COLE√á√ÉO DE RESTAURANTES
    // ===============================
    match /restaurants/{restaurantId} {
      // Permitir acesso para usu√°rios autenticados durante migra√ß√£o
      allow read, write: if isAuthenticated();
    }
    
    // ===============================
    // üë• COLE√á√ÉO DE USU√ÅRIOS  
    // ===============================
    match /users/{userId} {
      // Leitura: Pr√≥prio usu√°rio ou qualquer usu√°rio autenticado (transi√ß√£o)
      allow read: if isAuthenticated();
      
      // Cria√ß√£o/Atualiza√ß√£o: Qualquer usu√°rio autenticado
      allow create, update: if isAuthenticated();
      
      // Exclus√£o: Apenas pr√≥prio usu√°rio ou se for o criador
      allow delete: if isOwner(userId) || isAuthenticated();
    }
    
    // ===============================
    // üì¶ DADOS DO RESTAURANTE (TRANSI√á√ÉO)
    // ===============================
    match /insumos/{insumoId} {
      allow read, write: if isAuthenticated();
    }
    
    match /pratos/{pratoId} {
      allow read, write: if isAuthenticated();
    }
    
    match /fichasTecnicas/{fichaId} {
      allow read, write: if isAuthenticated();
    }
    
    match /compras/{compraId} {
      allow read, write: if isAuthenticated();
    }
    
    match /fornecedores/{fornecedorId} {
      allow read, write: if isAuthenticated();
    }
    
    match /configuracoes/{configId} {
      allow read, write: if isAuthenticated();
    }
    
    match /relatorios/{relatorioId} {
      allow read, write: if isAuthenticated();
    }
    
    match /notificacoes/{notificacaoId} {
      allow read, write: if isAuthenticated();
    }
    
    match /logs/{logId} {
      allow read: if isAuthenticated();
      allow write: if false; // Logs n√£o podem ser alterados
    }
    
    // ===============================
    // üö´ OUTRAS COLE√á√ïES
    // ===============================
    match /{document=**} {
      allow read, write: if isAuthenticated();
    }
  }
}
