name: ğŸš€ Deploy Cozinha Inteligente - Secure Edition

on:
  push:
    branches: [ main ]

# PermissÃµes necessÃ¡rias para GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# Permitir apenas um deploy simultÃ¢neo
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  # Deploy direto (sem Jekyll)
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    steps:
    - name: ğŸ“ Checkout
      uses: actions/checkout@v4

    - name: ğŸ”§ Setup Pages
      uses: actions/configure-pages@v4

    - name: ğŸ“‹ Verificar Sistema
      run: |
        echo "ğŸ” === COZINHA INTELIGENTE - SECURE EDITION ==="
        echo "ğŸ“… Deploy: $(date)"
        echo "ğŸ“¦ Commit: ${{ github.sha }}"
        echo ""
        echo "âœ… Verificando arquivos essenciais..."
        ls -la index.html && echo "âœ… index.html OK" || echo "âŒ index.html MISSING"
        ls -la js/main.js && echo "âœ… main.js OK" || echo "âŒ main.js MISSING"  
        ls -la firestore.rules && echo "âœ… Security Rules OK" || echo "âš ï¸ Rules Missing"
        echo ""
        echo "ğŸ” RECURSOS DE SEGURANÃ‡A IMPLEMENTADOS:"
        echo "- âœ… Firebase Authentication"
        echo "- âœ… User Data Isolation"
        echo "- âœ… Security Rules"  
        echo "- âœ… Protected Routes"
        echo "- âœ… Secure Login/Register"
        echo ""

    - name: ğŸ“¤ Upload Pages Artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: '.'

    - name: ğŸŒ Deploy to GitHub Pages
      id: deployment
      uses: actions/deploy-pages@v4

    - name: ğŸ‰ Deploy Success
      run: |
        echo "========================================="
        echo "ğŸ‰ DEPLOY REALIZADO COM SUCESSO!"
        echo "========================================="
        echo ""
        echo "ğŸŒ URL PÃšBLICA: ${{ steps.deployment.outputs.page_url }}"
        echo ""
        echo "ğŸ“‹ CHECKLIST PÃ“S-DEPLOY:"
        echo "1. âœ… Acesse a URL acima"
        echo "2. âœ… Teste tela de login/registro" 
        echo "3. âœ… Verifique autenticaÃ§Ã£o Firebase"
        echo "4. âœ… Teste CRUD bÃ¡sico (insumos)"
        echo "5. âœ… Confirme isolamento de dados"
        echo ""
        echo "ğŸ” SEGURANÃ‡A ATIVA:"
        echo "- âœ… AutenticaÃ§Ã£o obrigatÃ³ria"
        echo "- âœ… Dados protegidos por usuÃ¡rio"
        echo "- âœ… Firebase Security Rules aplicadas"
        echo ""
        echo "âš ï¸  IMPORTANTE:"
        echo "- Sistema seguro para uso em produÃ§Ã£o"
        echo "- Dados isolados entre usuÃ¡rios"  
        echo "- Acesso apenas com login vÃ¡lido"
