rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // üîê REGRAS DE SEGURAN√áA CR√çTICAS - IMPLEMENTA√á√ÉO IMEDIATA
    
    // ‚ùå REGRA PADR√ÉO: NEGAR TUDO por seguran√ßa
    match /{document=**} {
      allow read, write: if false;
    }
    
    // üë§ Dados do usu√°rio - APENAS o pr√≥prio usu√°rio pode acessar
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // ü•ï Insumos - APENAS dados do usu√°rio logado
    match /insumos/{insumoId} {
      allow read, write: if request.auth != null 
        && request.auth.uid == resource.data.userId;
      
      // Cria√ß√£o - garantir que userId seja o do usu√°rio logado
      allow create: if request.auth != null 
        && request.auth.uid == request.resource.data.userId;
    }
    
    // üìù Fichas T√©cnicas - APENAS dados do usu√°rio logado
    match /fichasTecnicas/{fichaId} {
      allow read, write: if request.auth != null 
        && request.auth.uid == resource.data.userId;
      
      allow create: if request.auth != null 
        && request.auth.uid == request.resource.data.userId;
    }
    
    // üçΩÔ∏è Pratos - APENAS dados do usu√°rio logado
    match /pratos/{pratoId} {
      allow read, write: if request.auth != null 
        && request.auth.uid == resource.data.userId;
      
      allow create: if request.auth != null 
        && request.auth.uid == request.resource.data.userId;
    }
    
    // üõí Compras - APENAS dados do usu√°rio logado
    match /compras/{compraId} {
      allow read, write: if request.auth != null 
        && request.auth.uid == resource.data.userId;
      
      allow create: if request.auth != null 
        && request.auth.uid == request.resource.data.userId;
    }
    
    // ‚öôÔ∏è Configura√ß√µes - APENAS dados do usu√°rio logado
    match /configuracoes/{configId} {
      allow read, write: if request.auth != null 
        && request.auth.uid == resource.data.userId;
      
      allow create: if request.auth != null 
        && request.auth.uid == request.resource.data.userId;
    }
    
    // üè∑Ô∏è Fornecedores - APENAS dados do usu√°rio logado
    match /fornecedores/{fornecedorId} {
      allow read, write: if request.auth != null 
        && request.auth.uid == resource.data.userId;
      
      allow create: if request.auth != null 
        && request.auth.uid == request.resource.data.userId;
    }
  }
}
